<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î∂ïÍ¥¥: Ïä§ÌÉÄÎ†àÏùº Ï∫êÎ¶≠ÌÑ∞ Ìã∞Ïñ¥Ìëú</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'ÎßëÏùÄ Í≥†Îîï', sans-serif;
            background: #1a1a2e;
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Ìó§Îçî ÏòÅÏó≠ */
        .header {
            background: linear-gradient(135deg, #0f0f23 0%, #16213e 100%);
            border-bottom: 3px solid #ffd700;
            padding: 20px 0;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-menu {
            display: flex;
            gap: 30px;
        }

        .nav-item {
            color: #cccccc;
            text-decoration: none;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #ffd700;
        }

        .nav-item.active {
            background: #ffd700;
            color: #000;
        }

        /* Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        /* ÌéòÏù¥ÏßÄ Ï†úÎ™© */
        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            color: #ffd700;
        }

        .page-title p {
            font-size: 1.1rem;
            color: #cccccc;
        }

        /* Ïª®Ìä∏Î°§ ÏòÅÏó≠ */
        .controls {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
        }

        .mode-btn {
            padding: 12px 25px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            background: transparent;
            color: #ffffff;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .mode-btn:hover {
            border-color: #ffd700;
            background: rgba(255, 215, 0, 0.1);
        }

        .mode-btn.active {
            background: #ffd700;
            color: #000;
            border-color: #ffd700;
        }

        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filter-select, .search-input {
            padding: 10px 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border-radius: 8px;
            font-size: 14px;
        }

        .filter-select option {
            background: #2c3e50;
            color: #ffffff;
        }

        .search-input::placeholder {
            color: #cccccc;
        }

        /* Ìã∞Ïñ¥ Î≥¥Îìú */
        .tier-board {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }



        .tier-row {
            display: flex;
            align-items: stretch;
            margin-bottom: 15px;
            min-height: 120px;
        }

        .tier-label {
            width: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            font-weight: bold;
            border-radius: 15px 0 0 15px;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .tier-label.S {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
        }

        .tier-label.A {
            background: linear-gradient(135deg, #ffa726, #ff9800);
        }

        .tier-label.B {
            background: linear-gradient(135deg, #66bb6a, #4caf50);
        }

        .tier-label.C {
            background: linear-gradient(135deg, #42a5f5, #2196f3);
        }

        .tier-label.D {
            background: linear-gradient(135deg, #ab47bc, #9c27b0);
        }

        .tier-content {
            flex: 1;
            background: rgba(255, 255, 255, 0.08);
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-left: none;
            border-radius: 0 15px 15px 0;
            padding: 15px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: flex-start;
            min-height: 120px;
            transition: all 0.3s;
            position: relative;
            z-index: 1;
        }

        .tier-content.dragover {
            background: rgba(255, 215, 0, 0.2);
            border-color: #ffd700;
        }

        .tier-content:empty::after {
            content: "Ï∫êÎ¶≠ÌÑ∞Î•º Ïó¨Í∏∞Ïóê ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî";
            color: #888;
            font-style: italic;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        /* ÎìúÎ°≠ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ */
        .drop-indicator {
            position: absolute;
            width: 3px;
            height: 90px;
            background: #ffd700;
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
            z-index: 10;
        }

        .drop-indicator.active {
            opacity: 1;
        }

        .character-card.drag-placeholder {
            opacity: 0.3;
            transform: scale(0.9);
            border: 2px dashed #ffd700;
        }

        /* Î™®Îã¨ Ïä§ÌÉÄÏùº */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 35, 126, 0.95), rgba(21, 101, 192, 0.95));
            margin: 2% auto;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 20px 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            margin: 0;
            color: #ffd700;
            font-size: 24px;
            font-weight: 700;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close:hover {
            color: #ffd700;
        }

        .modal-body {
            padding: 25px;
            max-height: 70vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label,
        .form-group .form-label {
            display: block;
            margin-bottom: 8px;
            color: #ffffff;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ffd700;
            background: rgba(255, 255, 255, 0.15);
        }

        .form-group input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .tier-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 10px;
        }

        .tier-input-group {
            display: flex;
            flex-direction: column;
        }

        .tier-input-group label {
            margin-bottom: 5px;
            font-size: 12px;
            color: #ffd700;
        }

        .tier-input-group select {
            padding: 8px 12px;
            font-size: 12px;
        }

        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .form-actions button {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .form-actions button[type="button"] {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .form-actions button[type="button"]:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .form-actions button[type="submit"] {
            background: #ffd700;
            color: #000000;
        }

        .form-actions button[type="submit"]:hover {
            background: #ffed4e;
            transform: translateY(-1px);
        }

        /* Ï∫êÎ¶≠ÌÑ∞ Ìà¥ÌåÅ */
        .character-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: #ffffff;
            padding: 10px 12px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            z-index: 1000;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            pointer-events: none;
            opacity: 0;
            transform: translateY(-5px);
            transition: opacity 0.2s, transform 0.2s;
        }

        .character-tooltip.show {
            opacity: 1;
            transform: translateY(0);
        }

        .character-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .tooltip-element {
            color: #ffd700;
            font-weight: 600;
        }

        .tooltip-path {
            color: #64b5f6;
            font-weight: 600;
        }

        /* Ï∫êÎ¶≠ÌÑ∞ Ïπ¥Îìú */
        .character-card {
            width: 80px;
            height: 95px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            cursor: grab;
            transition: all 0.3s;
            border: 2px solid transparent;
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
        }

        .character-card:hover {
            transform: scale(1.05);
            border-color: #ffd700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        }

        .character-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .character-image {
            width: 100%;
            height: 75px;
            position: relative;
            border-radius: 5px 5px 0 0;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
        }

        .character-image.loading {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
            text-align: center;
        }

        .character-image.rarity-5.fallback {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #000000;
            font-weight: bold;
            font-size: 12px;
        }

        .character-image.rarity-4.fallback {
            background: linear-gradient(135deg, #a855f7, #c084fc);
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
        }

        .character-image .character-initial {
            font-size: 14px;
            font-weight: 900;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
            z-index: 2;
        }

        .character-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 70%, rgba(255, 255, 255, 0.1));
            pointer-events: none;
        }

        .character-rarity {
            position: absolute;
            top: 2px;
            right: 2px;
            background: rgba(0, 0, 0, 0.8);
            color: #ffd700;
            font-size: 10px;
            padding: 1px 4px;
            border-radius: 3px;
        }

        .character-name {
            padding: 3px 5px;
            font-size: 10px;
            text-align: center;
            font-weight: bold;
            background: rgba(0, 0, 0, 0.8);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 18px;
            line-height: 1.2;
        }

        /* Ï∫êÎ¶≠ÌÑ∞ ÌíÄ */
        .character-pool {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .character-pool h3 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .character-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 15px;
        }

        /* Ï†ÄÏû•/Î∂àÎü¨Ïò§Í∏∞ Î≤ÑÌäº */
        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Î∞òÏùëÌòï ÎîîÏûêÏù∏ */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 20px;
            }

            .nav-menu {
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
            }

            .control-row {
                flex-direction: column;
                gap: 15px;
            }

            .tier-row {
                flex-direction: column;
                min-height: auto;
            }

            .tier-label {
                width: 100%;
                border-radius: 15px 15px 0 0;
                padding: 15px 0;
            }

            .tier-content {
                border-radius: 0 0 15px 15px;
                border-left: 2px dashed rgba(255, 255, 255, 0.2);
                border-top: none;
            }

            .character-grid {
                grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
                gap: 10px;
            }

            .character-card {
                width: 70px;
                height: 85px;
            }

            .character-image {
                height: 65px;
            }
        }

        /* Î°úÎî© Ïï†ÎãàÎ©îÏù¥ÏÖò */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left: 4px solid #ffd700;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    

    <!-- Î©îÏù∏ Ïª®ÌÖåÏù¥ÎÑà -->
    <div class="container">
        <!-- ÌéòÏù¥ÏßÄ Ï†úÎ™© -->
        <div class="page-title">
            <h1>Î∂ïÍ¥¥: Ïä§ÌÉÄÎ†àÏùº Ï∫êÎ¶≠ÌÑ∞ Ìã∞Ïñ¥Ìëú</h1>
            <p>ÏµúÏã† Î©îÌÉÄÏóê Îî∞Î•∏ Ï∫êÎ¶≠ÌÑ∞ Îì±Í∏â Î∂ÑÎ•ò ‚Ä¢ ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ÏúºÎ°ú Ìé∏Ïßë Í∞ÄÎä•</p>
        </div>

        <!-- Ïª®Ìä∏Î°§ ÏòÅÏó≠ -->
        <div class="controls">
            <div class="control-row">
                <div class="mode-selector">
                    <button class="mode-btn active" data-mode="general">Ï¢ÖÌï©</button>
                    <button class="mode-btn" data-mode="chaos">ÌòºÎèàÏùò Í∏∞Ïñµ</button>
                    <button class="mode-btn" data-mode="pure">ÏàúÏàòÌïú ÌóàÍµ¨</button>
                    <button class="mode-btn" data-mode="apocalyptic">Ï¢ÖÎßêÏùò Í∑∏Î¶ºÏûê</button>
                </div>
                <div class="filter-controls">
                    <input type="text" class="search-input" id="searchInput" placeholder="Ï∫êÎ¶≠ÌÑ∞ Í≤ÄÏÉâ...">
                    <select class="filter-select" id="elementFilter">
                        <option value="">Î™®Îì† ÏÜçÏÑ±</option>
                        <option value="Physical">Î¨ºÎ¶¨</option>
                        <option value="Fire">ÌôîÏóº</option>
                        <option value="Ice">ÎπôÍ≤∞</option>
                        <option value="Lightning">ÎáåÏ†Ñ</option>
                        <option value="Wind">Î∞îÎûå</option>
                        <option value="Quantum">ÏñëÏûê</option>
                        <option value="Imaginary">ÌóàÏàò</option>
                    </select>
                    <select class="filter-select" id="pathFilter">
                        <option value="">Î™®Îì† Ïö¥Î™Ö</option>
                        <option value="Destruction">ÌååÎ©∏</option>
                        <option value="Hunt">ÏàòÎ†µ</option>
                        <option value="Erudition">ÏßÄÏãù</option>
                        <option value="Harmony">Ï°∞Ìôî</option>
                        <option value="Nihility">ÌóàÎ¨¥</option>
                        <option value="Preservation">Ï°¥Ìò∏</option>
                        <option value="Abundance">ÌíçÏöî</option>
                        <option value="Memories">Í∏∞Ïñµ</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Ìã∞Ïñ¥ Î≥¥Îìú -->
        <div class="tier-board">
            <div class="tier-row">
                <div class="tier-label S">S</div>
                <div class="tier-content" data-tier="S" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="tier-row">
                <div class="tier-label A">A</div>
                <div class="tier-content" data-tier="A" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="tier-row">
                <div class="tier-label B">B</div>
                <div class="tier-content" data-tier="B" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="tier-row">
                <div class="tier-label C">C</div>
                <div class="tier-content" data-tier="C" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            </div>
            <div class="tier-row">
                <div class="tier-label D">D</div>
                <div class="tier-content" data-tier="D" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
            </div>
        </div>

        <!-- Ï∫êÎ¶≠ÌÑ∞ ÌíÄ -->
        <div class="character-pool">
            <h3>üì¶ Ï∫êÎ¶≠ÌÑ∞ Î™©Î°ù</h3>
            <div class="character-grid" id="characterPool"></div>
        </div>

        <!-- Ïï°ÏÖò Î≤ÑÌäº -->
        <div class="action-buttons">
            <button class="btn btn-primary" onclick="openAddCharacterModal()">‚ûï ÏÉà Ï∫êÎ¶≠ÌÑ∞ Ï∂îÍ∞Ä</button>
            <button class="btn btn-primary" onclick="saveTierList()">üíæ Ìã∞Ïñ¥Ìëú Ï†ÄÏû•</button>
            <button class="btn btn-secondary" onclick="loadTierList()">üìÇ Ìã∞Ïñ¥Ìëú Î∂àÎü¨Ïò§Í∏∞</button>
            <button class="btn btn-secondary" onclick="resetTierList()">üîÑ Ï¥àÍ∏∞Ìôî</button>
            <button class="btn btn-secondary" onclick="exportImage(this)">üì∏ Ïù¥ÎØ∏ÏßÄÎ°ú ÎÇ¥Î≥¥ÎÇ¥Í∏∞</button>
        </div>

        <!-- ÏÉà Ï∫êÎ¶≠ÌÑ∞ Ï∂îÍ∞Ä Î™®Îã¨ -->
        <div id="addCharacterModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>ÏÉà Ï∫êÎ¶≠ÌÑ∞ Ï∂îÍ∞Ä</h2>
                    <span class="close" onclick="closeAddCharacterModal()" onkeydown="if(event.key==='Enter'||event.key===' ')closeAddCharacterModal()" tabindex="0" role="button" aria-label="Î™®Îã¨ Îã´Í∏∞">&times;</span>
                </div>
                <div class="modal-body">
                    <form id="addCharacterForm">
                        <div class="form-group">
                            <label for="charId">Ï∫êÎ¶≠ÌÑ∞ ID:</label>
                            <input type="text" id="charId" required placeholder="Ïòà: kafka">
                        </div>
                        
                        <div class="form-group">
                            <label for="charName">ÌïúÍµ≠Ïñ¥ Ïù¥Î¶Ñ:</label>
                            <input type="text" id="charName" required placeholder="Ïòà: Ïπ¥ÌîÑÏπ¥">
                        </div>
                        
                        <div class="form-group">
                            <label for="charEnName">ÏòÅÏñ¥ Ïù¥Î¶Ñ:</label>
                            <input type="text" id="charEnName" required placeholder="Ïòà: Kafka">
                        </div>
                        
                        <div class="form-group">
                            <label for="charRarity">Î≥ÑÍ∏â:</label>
                            <select id="charRarity" required>
                                <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                <option value="4">4ÏÑ±</option>
                                <option value="5">5ÏÑ±</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="charElement">ÏÜçÏÑ±:</label>
                            <select id="charElement" required>
                                <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                <option value="Physical">Î¨ºÎ¶¨</option>
                                <option value="Fire">Î∂à</option>
                                <option value="Ice">ÏñºÏùå</option>
                                <option value="Lightning">Î≤àÍ∞ú</option>
                                <option value="Wind">Î∞îÎûå</option>
                                <option value="Quantum">ÏñëÏûê</option>
                                <option value="Imaginary">ÌóàÏàò</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="charPath">Ïö¥Î™ÖÏùò Í∏∏:</label>
                            <select id="charPath" required>
                                <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                <option value="Destruction">Î©∏Îßù</option>
                                <option value="Hunt">ÏàòÎ†µ</option>
                                <option value="Erudition">ÏßÄÏãù</option>
                                <option value="Harmony">Ï°∞Ìôî</option>
                                <option value="Nihility">ÌóàÎ¨¥</option>
                                <option value="Preservation">Ï°¥Ìò∏</option>
                                <option value="Abundance">ÌíçÏöî</option>
                                <option value="Memories">Í∏∞Ïñµ</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="charImage">Ïù¥ÎØ∏ÏßÄ URL (ÏÑ†ÌÉùÏÇ¨Ìï≠):</label>
                            <input type="url" id="charImage" placeholder="https://...">
                        </div>
                        
                        <div class="form-group">
                            <span class="form-label">Í∏∞Î≥∏ Ìã∞Ïñ¥ ÏÑ§Ï†ï:</span>
                            <div class="tier-inputs">
                                <div class="tier-input-group">
                                    <label for="tierGeneral">ÏùºÎ∞ò:</label>
                                    <select id="tierGeneral">
                                        <option value="S">S</option>
                                        <option value="A">A</option>
                                        <option value="B" selected>B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                <div class="tier-input-group">
                                    <label for="tierChaos">ÌòºÎèàÏùò Í∏∞Ïñµ:</label>
                                    <select id="tierChaos">
                                        <option value="S">S</option>
                                        <option value="A">A</option>
                                        <option value="B" selected>B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                <div class="tier-input-group">
                                    <label for="tierPure">ÏàúÏàò ÌóàÍµ¨:</label>
                                    <select id="tierPure">
                                        <option value="S">S</option>
                                        <option value="A">A</option>
                                        <option value="B" selected>B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                                <div class="tier-input-group">
                                    <label for="tierApocalyptic">Ï¢ÖÎßê Í∑∏Î¶ºÏûê:</label>
                                    <select id="tierApocalyptic">
                                        <option value="S">S</option>
                                        <option value="A">A</option>
                                        <option value="B" selected>B</option>
                                        <option value="C">C</option>
                                        <option value="D">D</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-actions">
                            <button type="button" onclick="closeAddCharacterModal()">Ï∑®ÏÜå</button>
                            <button type="submit">Ï∂îÍ∞Ä</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ïà®Í≤®ÏßÑ ÌååÏùº ÏûÖÎ†• -->
        <input type="file" id="fileInput" accept="application/json" style="display: none;" onchange="importTierList(event)">
    </div>

    <script>
        // Ïä§ÌÉÄÎ†àÏùº Ï∫êÎ¶≠ÌÑ∞ Îç∞Ïù¥ÌÑ∞ (Ï†ÑÏ≤¥ Ï∫êÎ¶≠ÌÑ∞ Ìè¨Ìï®)
        const characters = [
            // === 5ÏÑ± Ï∫êÎ¶≠ÌÑ∞ ===
            {
                id: "kafka",
                name: "Ïπ¥ÌîÑÏπ¥",
                enName: "Kafka",
                rarity: 5,
                element: "Lightning",
                path: "Nihility",
                image: "https://i.namu.wiki/i/fM641qp4V6eSvvRS00uS5iGwIb6D2j6QhAxDuSzifMv1uim177GJcttUpxbSyoxjYX-Bl07GNgYSqzt_VIkkQQ.webp",
                defaultTiers: { general: "S", chaos: "A", pure: "S", apocalyptic: "A" }
            },
            {
                id: "seele",
                name: "Ï†úÎ†à",
                enName: "Seele",
                rarity: 5,
                element: "Quantum",
                path: "Hunt",
                image: "https://i.namu.wiki/i/WdbRue-lU8k8dQaXmI0FYy3LocXmqUEBiEvfvNTRFynPwI4qlVKvMUski82oVBS0m9TZFcTzIxwdKee422_OBw.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "A", apocalyptic: "S" }
            },
            {
                id: "jingliu",
                name: "Í≤ΩÎ•ò",
                enName: "Jingliu",
                rarity: 5,
                element: "Ice",
                path: "Destruction",
                image: "https://i.namu.wiki/i/SW2rbu7qc5QtCR6XE1q80AeE7C39QeRgmIC9Rt6OcFQh3-zhTcP1og1NYWukMvMqIo9JEyd8tevKxYtKQdo6PQ.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "A", apocalyptic: "S" }
            },
            {
                id: "danheng-il",
                name: "Îã®Ìï≠¬∑ÏùåÏõî",
                enName: "Dan Heng ‚Ä¢ Imbibitor Lunae",
                rarity: 5,
                element: "Imaginary",
                path: "Destruction",
                image: "https://i.namu.wiki/i/bPkjckUIS829XfOQfgFGhoT4LH-G_YqkVt2D9QbVciMj3tVXl_1QeC_wPCkJb4FI3oxYJbhoNvXccZri7V0hoA.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "A", apocalyptic: "A" }
            },
            {
                id: "bronya",
                name: "Î∏åÎ°úÎÉê",
                enName: "Bronya",
                rarity: 5,
                element: "Wind",
                path: "Harmony",
                image: "https://i.namu.wiki/i/RUwehd_8P_bmOD01LUfSKBAhdi-WcbvrNl8etIengFOFEoveDugY_U50e6L39hijLzCmXOn9XrlJaxU1PD225A.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "S", apocalyptic: "S" }
            },
            {
                id: "fuxuan",
                name: "Î∂ÄÌòÑ",
                enName: "Fu Xuan",
                rarity: 5,
                element: "Quantum",
                path: "Preservation",
                image: "https://i.namu.wiki/i/EaW-dJGo9A_fjeU6loBjQ9plSSrUDG_4L1NKsYWs0Y9lXJ_JqYD_0CBtqrwi--CPb9oVyy_5wcAEzvP8pYlT3w.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "A", apocalyptic: "A" }
            },
            {
                id: "huohuo",
                name: "Í≥ΩÌñ•",
                enName: "Huohuo",
                rarity: 5,
                element: "Wind",
                path: "Abundance",
                image: "https://i.namu.wiki/i/LqLnXvBQ15oJV0Tb0pPRb6lYbpA7l4zE1dIeyVOEjuNm6sY3QwPMph84h9DJPN-THewHMuHdo9pA35-2mW6Gvg.webp",
                defaultTiers: { general: "S", chaos: "A", pure: "S", apocalyptic: "S" }
            },
            {
                id: "topaz",
                name: "ÌÜ†ÌååÏ¶à",
                enName: "Topaz & Numby",
                rarity: 5,
                element: "Fire",
                path: "Hunt",
                image: "https://i.namu.wiki/i/nBfBzYKZYUgfPsWbjwdNj-6iqZuAVGDY_MguV4YTdbZmC2g5J96wEwXfIOLjwFyf3wIDPJQUlDIHYQuRVWzxtQ.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "S", apocalyptic: "A" }
            },
            {
                id: "aventurine",
                name: "Ïñ¥Î≤§Ï∏ÑÎ¶∞",
                enName: "Aventurine",
                rarity: 5,
                element: "Imaginary",
                path: "Preservation",
                image: "https://i.namu.wiki/i/DRb6dxzr9SJ_Q0HG2oynLBgCAxry04F1ZLMcxe1USpNl3mWJAE2fD6VWsTBRRj0x1b8I2WQuc7IxQ3HbTnr0gA.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "S", apocalyptic: "A" }
            },
            {
                id: "luocha",
                name: "ÎÇòÏ∞∞",
                enName: "Luocha",
                rarity: 5,
                element: "Imaginary",
                path: "Abundance",
                image: "https://i.namu.wiki/i/qANZZcdNok_lZcGWU-blAqvV00vwUcOCK8ttBjekpbfpQ_-Yr5SCiaB5sx9GDAbQXoevj2xY2ACQc22IY58ONRKl8RDlwCI1Zk-MfC5ceevvzIMWnYE2b66pbQjDN81B1Vr9uCsUKZ0l7BCoUDtoCw.webp",
                defaultTiers: { general: "A", chaos: "S", pure: "A", apocalyptic: "B" }
            },
            {
                id: "bailu",
                name: "Î∞±Î°ú",
                enName: "Bailu",
                rarity: 5,
                element: "Lightning",
                path: "Abundance",
                image: "https://i.namu.wiki/i/RtH25-8gMlpfmktsTSpoiqN6L9PhkT6g5ef6XxWwGKejSZrfWPZgFTGDi7bb6oDPsZwzNaMXTMWCWFvbkVJcrBgRxsAl7JRKbCRocUyXJg688dHNBs3PBswo_aUVbfIjVpCoyLs8cW2p7OzMwvn0cQ.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "clara",
                name: "ÌÅ¥ÎùºÎùº",
                enName: "Clara",
                rarity: 5,
                element: "Physical",
                path: "Destruction",
                image: "https://i.namu.wiki/i/k6n5rbXss3LE9sP9AW0kF_rlrDx90oHxcVvEMgrv4dRRQbE8nSdcfRxAJUCV08dH7D6Sdbkzu5gGdF8z_POmYOOWrp_-MsWBmKWyy1Tz3kz_SrWt7W_5zht09xvdqvV6w1H-ws5h9Bcu0ij82RT_kg.webp",
                defaultTiers: { general: "A", chaos: "B", pure: "A", apocalyptic: "B" }
            },
            {
                id: "yanqing",
                name: "Ïó∞Í≤Ω",
                enName: "Yanqing",
                rarity: 5,
                element: "Ice",
                path: "Hunt",
                image: "https://i.namu.wiki/i/2PoR7rCAw0e0O_0vWW6SJw0ubhO8mSAMcs_RRSYrxGXS9m7LwPvj1o7yLpNTzgp-ErELp66EXBHmKEI_HEWpJGCnUYS81YX_bXSLHOSrk2uRzi82CXPIjtFFYap1qeGRcPQOhNfbdc9G1WaqoMiu4Q.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "himeko",
                name: "ÌûàÎ©îÏΩî",
                enName: "Himeko",
                rarity: 5,
                element: "Fire",
                path: "Erudition",
                image: "https://i.namu.wiki/i/KO7EWjuScXHdTzWeyIZ2sAsSNwoyB3QU8opqdbwP_Kkxvg2yYZhuJDA3mtjTk0eg5IWwnMk8PGp-XQOeQcsCIA.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "welt",
                name: "ÏõîÌä∏",
                enName: "Welt",
                rarity: 5,
                element: "Imaginary",
                path: "Nihility",
                image: "https://i.namu.wiki/i/Di6XmXmdholmL9Ze67nWrtCOitFYmTS1BLPbOB0LDOWBUbp-IiMKc7UMYdY-nNEldJjpU5HrBmtzNhX1t7aOmYyViiI28VOyFc21aYaBv0HTzZFFtE10IYUJx1k90Ofx_2Ht8scMYcjLnmTXvVCZSg.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "gepard",
                name: "Ï†úÌååÎìú",
                enName: "Gepard",
                rarity: 5,
                element: "Ice",
                path: "Preservation",
                image: "https://i.namu.wiki/i/g3tsFl35JjGvklT1eowvVJ772bOIBdNAywTLg5H4fBnnROZfgga_bL99l5cymGje6X9kq_NRG9xIj-bNQyNAb40jYRqx2_tpI-h1cX2XIAqnGtNF8YTJgCOR_DpCK5PCnNatCQPk4TBZIlVx4P1HMA.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "silverwolf",
                name: "ÏùÄÎûë",
                enName: "Silver Wolf",
                rarity: 5,
                element: "Quantum",
                path: "Nihility",
                image: "https://i.namu.wiki/i/OmbUMdN8RzMqxEEXS7ccpOKhoKT3oQMemuc_zWtQGlpZKNFdKGnY0wP0ZutUjuPWL20g-8l8VZGOfCAnqDhcQhSiozifDJ0nSRWb-PXMxrEwj1WMOBBdDn7ttz-vneDXQm8bam2sVWFpIq5-ikQR8Q.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "blade",
                name: "Î∏îÎ†àÏù¥Îìú",
                enName: "Blade",
                rarity: 5,
                element: "Wind",
                path: "Destruction",
                image: "https://i.namu.wiki/i/v6P1y_anrTu0PvR8j5UWxR3FSuvEHFJJ2Rp_mIZTHwWydnG8pmKlJ7_m-9g9V2LhGLfEJhRL1v35xrVzjhMc_grLDDmE7hebcR3sPNRFDY08-bK7BS9FR6aZkl7J5bOa8zpeoWomvtUHtAnJPhzoDQ.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "argenti",
                name: "ÏïÑÏ††Ìã∞",
                enName: "Argenti",
                rarity: 5,
                element: "Physical",
                path: "Erudition",
                image: "https://i.namu.wiki/i/_2A8L-PSaC7BnMe8XwdoaG7SsF-tMNvAGa7Lemqr0n6-jUTdoPShgbLWeXoajk1P3Bmdlqv6CMEmiGUertN80A.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "ruanmei",
                name: "ÏôÑÎß§",
                enName: "Ruan Mei",
                rarity: 5,
                element: "Ice",
                path: "Harmony",
                image:"https://i.namu.wiki/i/A_1Tqb1D0eUBLFzjKaNcHjvCktKZbT35QJcM-qBxUZcX-K7VeQm9cJW5BLAXG-9ImOxU58v0WzgOfUbLkR2KuQ.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "S", apocalyptic: "S" }
            },
            {
                id: "drratio",
                name: "DR. Î†àÏù¥ÏãúÏò§",
                enName: "Dr. Ratio",
                rarity: 5,
                element: "Imaginary",
                path: "Hunt",
                image: "https://i.namu.wiki/i/odGx_dRhPIRq-ctBddIZw9pAWfYryK5VMO9bkxcvlSERWpL0a_k-ubSpsP82CScnvjmTpCZUGXVs00S49gCxwA.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "blackswan",
                name: "Î∏îÎûô Ïä§ÏôÑ",
                enName: "Black Swan",
                rarity: 5,
                element: "Wind",
                path: "Nihility",
                image: "https://i.namu.wiki/i/rnQPa5Sm50q6GJt6UA_H-wk4_dDNA7T_IADbkiMhqDvLG7cpA_sly-XIgv30vQ0EcvLN2W2ar7UfNOCOUq9_lA.webp",
                defaultTiers: { general: "A", chaos: "S", pure: "A", apocalyptic: "A" }
            },
            {
                id: "sparkle",
                name: "Ïä§ÌååÌÅ¥",
                enName: "Sparkle",
                rarity: 5,
                element: "Quantum",
                path: "Harmony",
                image:"https://i.namu.wiki/i/XHOB3B1AI3kdgzJdltz7gMrPiDNXsSIIDERWWApaKnJZszhsptAkTHs-M5bV1Lw4upBkv3zRd86OvEKQ_pIEKg.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "S", apocalyptic: "S" }
            },
            {
                id: "acheron",
                name: "ÏïÑÏºÄÎ°†",
                enName: "Acheron",
                rarity: 5,
                element: "Lightning",
                path: "Nihility",
                image:"https://i.namu.wiki/i/2Qxekiw0b-CzIeu8yeeRz2UoRi-qxCg80BjzR1Va4V0sLIVq6QdlH7Bk4c5hNEz5osEzuLMEQairCSy7UBSG8Q.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "S", apocalyptic: "S" }
            },
            {
                id: "robin",
                name: "Î°úÎπà",
                enName: "Robin",
                rarity: 5,
                element: "Physical",
                path: "Harmony",
                image:"https://i.namu.wiki/i/rYfxGKuLJW27D96PRLXOIxTaqC52rZ8uBVnpZx8R2fxbAAEGlisoSAWCYObHidgOA7ckdOnybubmpd1oDTW52g.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "S", apocalyptic: "S" }
            },
            {
                id: "boothill",
                name: "Î∂ÄÌä∏Ìûê",
                enName: "Boothill",
                rarity: 5,
                element: "Physical",
                path: "Hunt",
                image: "https://i.namu.wiki/i/JwBT408d8DkTy-fSEh9djz4GTQlrs6vi31cfOHZZuIZAJC_u-P6pcRUZ-0lL7BoFswCf3387Z4xpw-69L_PhZw.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "firefly",
                name: "Î∞òÎîî",
                enName: "Firefly",
                rarity: 5,
                element: "Fire",
                path: "Destruction",
                image: "https://i.namu.wiki/i/1hkgdZki6QXFXXZemi1b6JdvVoinwnpVEUmsaFi9yGaNoJksEQjw750GVldn2wSIqlM80OTqOZ31rB_RGnhgTg.webp",
                defaultTiers: { general: "S", chaos: "S", pure: "S", apocalyptic: "S" }
            },
            {
                id: "jade",
                name: "Ï†úÏù¥Îìú",
                enName: "Jade",
                rarity: 5,
                element: "Quantum",
                path: "Erudition",
                image: "https://i.namu.wiki/i/kDD4uYSUcIYbKUkyPhyeNF8Yj6hiImxFsX3gRDEC3dTVwQ-oOsfMpJGk-aBppCXdY4y_i-PHc2wYtnsijZqPDg.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },

            // === 4ÏÑ± Ï∫êÎ¶≠ÌÑ∞ ===
            {
                id: "march7th",
                name: "Mar. 7th",
                enName: "March 7th",
                rarity: 4,
                element: "Ice",
                path: "Preservation",
                image: "https://i.namu.wiki/i/aW0fGJzMU3F6B-7muvjIVbHa60gqHiCk1wU5NDzI6L5pTmZQGb9Xss4dK8-2MuzL-wGuwDTyhYBpM6HVRVkZGikobOMBN4NWRQIlhlRWYIu5z5wxavJZCIl3IEsXJYRghU8WHH-P_ZZd-g5GHrtPTw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "danheng",
                name: "Îã®Ìï≠",
                enName: "Dan Heng",
                rarity: 4,
                element: "Wind",
                path: "Hunt",
                image: "https://i.namu.wiki/i/Tks4G-TGoC6dk7ZJUO_BRNYMsmJn4D_caqBWw2JAtSvXxSgcpMTV1oZuJ2HBdT5FQcpJTyuw3IbDOq2vYfCR4Tz7_L2GMcx2pMOVthaz8_35dM5zWXkaNGiLQLTZS2OY-VE5s5BYHaBocgdgUvp5BQ.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "C" }
            },
            {
                id: "asta",
                name: "ÏïÑÏä§ÌÉÄ",
                enName: "Asta",
                rarity: 4,
                element: "Fire",
                path: "Harmony",
                image: "https://i.namu.wiki/i/u8sL-WxliucAMlbPng1GWGWqYsEr6p-1y-MwMTvpSj7AL0c0YfOqN2NWyaJfmO7xvzpzzCjXJIOefB3c2rfuWA.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "arlan",
                name: "ÏïÑÎ•ºÎûÄ",
                enName: "Arlan",
                rarity: 4,
                element: "Lightning",
                path: "Destruction",
                image:"https://i.namu.wiki/i/nsxLXDFcN5W7tr5da03glt6VbPGDYCGR1kxM3x7m4PUJ77LMcqKuXwIXxv06Dmvwx4SyjKZ_lS_qPYkUcCr5c9O2bBaBeFPpROPuIZIrMOO7r09fV79npB2LpPY1nZVe5uSTkkdGXBPe5CSNuPIiug.webp",
                defaultTiers: { general: "C", chaos: "C", pure: "C", apocalyptic: "C" }
            },
            {
                id: "The herta",
                name: "Îçî Ìó§Î•¥ÌÉÄ",
                enName: "Herta",
                rarity: 5,
                element: "Ice",
                path: "Erudition",
                image: "https://i.namu.wiki/i/dce08pK_wIdoq_T1PUS_aifGpYAp8mekQrOOSG3NAczTcW2MAcBfbO3AQz51JwOJJriSff0oyBdSFKU17cBN2g.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "hook",
                name: "ÌõÑÌÅ¨",
                enName: "Hook",
                rarity: 4,
                element: "Fire",
                path: "Destruction",
                image: "https://i.namu.wiki/i/_PJr5bjWHDTeoqEio4xfpU-GCEFf4W4Cg9N5ORWHsKGYJ-wewzYJ1sY5QRGMZUfHQ_-ht85S9MLobpAtgv2Rw8mjmkKptAu0TPs9KMZxNkWk1jDiBbICG2uFBDz1BjbbWVbbr5W2hKXft2FoZPKAJA.webp",
                defaultTiers: { general: "C", chaos: "C", pure: "C", apocalyptic: "C" }
            },
            {
                id: "natasha",
                name: "ÎÇòÌÉÄÏÉ§",
                enName: "Natasha",
                rarity: 4,
                element: "Physical",
                path: "Abundance",
                image: "https://i.namu.wiki/i/RoSCch7ahdRxxiFzygid_lpYIG7S9VfrHpOpxqAvuA5FtsqCtovwNd71ihM8DhhQLLs59JVWI4dXyDfuLzc3A5kpeEbFNwqrb1sNs4UL8qvTfBUMki23d8DpJKOQEQOiob6OcU0Nuva1d5BL_g2S1Q.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "pela",
                name: "ÌéòÎùº",
                enName: "Pela",
                rarity: 4,
                element: "Ice",
                path: "Nihility",
                image: "https://i.namu.wiki/i/QYNSAUMU9dixMW1vVOLG3QDMfYDuGEDjGzzsIjTRzkjdpOvuufdoeUVcXyTnQw21pIG5NBxGu2mDH5zr-JDK0w.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "qingque",
                name: "Ï≤≠Ïûë",
                enName: "Qingque",
                rarity: 4,
                element: "Quantum",
                path: "Erudition",
                image: "https://i.namu.wiki/i/NJlg0m6u9njKWjUZbifW-a_PnejlTJum-5oGTGLg3IafkyoqSDYRAZHAm-j895snANd-0T0h5dWkK3QMbukRSljg99q1Oceply1T1rt8FmzNyM9aBoM8d3fULJBfiGakBgnITNTBb8aP9kJItyrNNw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "sampo",
                name: "ÏÇºÌè¨",
                enName: "Sampo",
                rarity: 4,
                element: "Wind",
                path: "Nihility",
                image: "https://i.namu.wiki/i/7QTD921S4eMtfLUljXleMgDq6raUBOCUxXCWfLmeOsje9GXV5Sq1gjmDfvBDRy7T_dSrOSqRlP97Df37_s82b6HbS3PB362yuNl-mrd2_9sqlki94rce1d4klGgH5I2duW8MSa4nc_56StvH3DcoDw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "serval",
                name: "ÏÑúÎ≤å",
                enName: "Serval",
                rarity: 4,
                element: "Lightning",
                path: "Erudition",
                image: "https://i.namu.wiki/i/PgOC0gKZ1uzKtBoy6FYi9Qazls-SLg8FwrjF6ysFGfpzMMh7O8P7op2sxJcIp2vVjnqroAetVqh-CEWJi6SfTrClkLImgbYY2dRHej3hATLDE4EPsiX8m9iwIu7knAD2MganfBQQqGaliinAVz_luw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "sushang",
                name: "ÏÜåÏÉÅ",
                enName: "Sushang",
                rarity: 4,
                element: "Physical",
                path: "Hunt",
                image: "https://i.namu.wiki/i/NwAGeNMNy6nIhViDYLOZY7E-ADA7vdOyTySQnPDBI_Vbpf6L_1PNxVj82n72CRSruY2q6xGqf5tRKxfEdQDruIN-2nd7Vd1CLcLXmNoNke_KmfixJrlhSeFv1H0pWHsKJEbEzBFNOSSnD5WsAIyfQQ.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "tingyun",
                name: "Ï†ïÏö¥",
                enName: "Tingyun",
                rarity: 4,
                element: "Lightning",
                path: "Harmony",
                image: "https://i.namu.wiki/i/jQGx3g30wv5xibtHLT7MKju_xv9pZv6cscMK10YdKmJdWVq2EdmWuMWDqCB_Te-CqZ0QJQfnubBooq78qC7yIQ.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "yukong",
                name: "Ïñ¥Í≥µ",
                enName: "Yukong",
                rarity: 4,
                element: "Imaginary",
                path: "Harmony",
                image: "https://i.namu.wiki/i/qe67uvjQ0u6ZekA1THnP4Eh9XiDE_KLMyp4LpDDQFbWE5pyp5CNsCkVpRTBMULuePrp6caQ9zNuGeCfKZz1SHul7Sos9qz2d8GL8REABpIOs7NC_j-eLUOfTNMmwaN86lykkBKg0-gdYAjRWxkcX4Q.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "luka",
                name: "Î£®Ïπ¥",
                enName: "Luka",
                rarity: 4,
                element: "Physical",
                path: "Nihility",
                image: "https://i.namu.wiki/i/e6YWS6c5CU47hPNzXzLnlLn5a_VxeAep0X23Uso8DFSG48ixWd6-G3OdiPA0n_yhVoK3O0pb9G77mR-hU9CjPw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "lynx",
                name: "ÎßÅÏä§",
                enName: "Lynx",
                rarity: 4,
                element: "Quantum",
                path: "Abundance",
                image: "https://i.namu.wiki/i/WL4pLIoF09wFsSqn_kQTimC5j0nS-Xb4O6vKONJWeIiqpmHCnSeroC2AwoiXVrxbLxRRy-AG0FthXPk96lNjoc6_Mus1r1HhWcKo4_1reeteUGiT4HZeE-TUTFSrusHARW6PbeqAi6Y-9Zw_Hrl8Og.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "guinaifen",
                name: "Í≥ÑÎÑ§Îπà",
                enName: "Guinaifen",
                rarity: 4,
                element: "Fire",
                path: "Nihility",
                image: "https://i.namu.wiki/i/8dyjZJcF69jJGF7mXJxw6cc6ITuyrX3l2kJ9Mf3mct5-Tq67-YrVEhl8FZTWcsjZhIzUQPT5YGnW0FvhurSqsw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "hanya",
                name: "ÌïúÏïÑ",
                enName: "Hanya",
                rarity: 4,
                element: "Physical",
                path: "Harmony",
                image: "https://i.namu.wiki/i/qdlrM8mVrnyfZnLoibIeaQ3x5a-hHDvgeNNuNGljvvLJ1UF5he-FeWRfSbw-0dPkgOJthX4VqbuUp1MbXhTjGw.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "xueyi",
                name: "ÏÑ§Ïùò",
                enName: "Xueyi",
                rarity: 4,
                element: "Quantum",
                path: "Destruction",
                image: "https://i.namu.wiki/i/AnXvd1mlj4szczeitUbyBM2Jlddl6I2XUGx0PNgR50wxVKjN7gyeeDYN-VdaIeoOh4PzNJv_IzV0yDe-pXaSdKk92vLSjpXnLqQVR5R3tbZ3Fh85tXcupQYbjBLD_UgGUzD5Y_tKvC3YsShLij2_pQ.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "misha",
                name: "ÎØ∏ÏÉ§",
                enName: "Misha",
                rarity: 4,
                element: "Ice",
                path: "Destruction",
                image: "https://i.namu.wiki/i/YFzKjsBD-adJCjkcKzMVe_0dLhZZ6SAxqImT7aBJU32AkI4xzYOmH2sVJxeuLWjilCCFR4Cv3Q5CLAAAvxk-Hu_Wjzi4cU3ww1ifr6TJLFNJsPT6fS-uts491A5QYxdqNhcJ2Tcymzp40f2MvI2rUA.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "gallagher",
                name: "Í∞§Îü¨Í±∞",
                enName: "Gallagher",
                rarity: 4,
                element: "Fire",
                path: "Abundance",
                image: "https://i.namu.wiki/i/vrSaDUULQxDOutd1P8RISLywjCPl5iKoTO18pXsJ4LUVPGYLFhKHjwP_xMyOCL5VOZJC-g6sNFPnQi1RjJQNMw.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            },
            {
                id: "moze",
                name: "Îß•ÌÉù",
                enName: "Moze",
                rarity: 4,
                element: "Lightning",
                path: "Hunt",
                image: "https://i.namu.wiki/i/bT5ozcE2NTUoSUac_8KLaUHj3KZmUAV_F3NySNV39lra_1e__f6UF5OQT0wEeaGcw3uMPR14nAu9OaigDRfh9i3tv7twwV6mR9xd9UdUo7rfoLGsMwQEa136Qn1hNcmijIbUSpvYURzr-Q-vjr3NMQ.webp",
                defaultTiers: { general: "B", chaos: "B", pure: "B", apocalyptic: "B" }
            },
            {
                id: "jiaoqiu",
                name: "Ï¥àÍµ¨",
                enName: "Jiaoqiu",
                rarity: 5,
                element: "Fire",
                path: "Nihility",
                image: "https://i.namu.wiki/i/dstI1FZ-lb-Oh-AU5W9ygqPVv5xU7H4cX4wzsOtB1mK7dP4G1vrH-MTRuv4cKxV_45AZHRW9iB9GHE7QAUCBgA.webp",
                defaultTiers: { general: "A", chaos: "A", pure: "A", apocalyptic: "A" }
            }
        ];

        let currentMode = 'general';
        let currentTiers = {};
        let currentTierOrders = {};

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞Ìôî
        document.addEventListener('DOMContentLoaded', function() {
            initializeTierList();
            setupEventListeners();
            loadFromStorage();
        });

        // Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
        function setupEventListeners() {
            // Î™®Îìú Î≤ÑÌäº
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    setMode(this.dataset.mode);
                });
            });

            // Í≤ÄÏÉâ Î∞è ÌïÑÌÑ∞
            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('elementFilter').addEventListener('change', applyFilters);
            document.getElementById('pathFilter').addEventListener('change', applyFilters);
        }

        // Ìã∞Ïñ¥Î¶¨Ïä§Ìä∏ Ï¥àÍ∏∞Ìôî
        function initializeTierList() {
            // ÌòÑÏû¨ Ìã∞Ïñ¥ ÏÑ§Ï†ïÏùÑ Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï¥àÍ∏∞Ìôî
            characters.forEach(char => {
                currentTiers[char.id] = { ...char.defaultTiers };
            });
            updateDisplay();
        }

        // Î™®Îìú Î≥ÄÍ≤Ω
        function setMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            updateDisplay();
        }

        // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
        function updateDisplay() {
            updateTierBoard();
            updateCharacterPool();
        }

        // Ìã∞Ïñ¥ Î≥¥Îìú ÏóÖÎç∞Ïù¥Ìä∏
        function updateTierBoard() {
            const tiers = ['S', 'A', 'B', 'C', 'D'];
            
            tiers.forEach(tier => {
                const container = document.querySelector(`[data-tier="${tier}"]`);
                container.innerHTML = '';
                
                let charactersInTier = characters.filter(char => 
                    currentTiers[char.id] && currentTiers[char.id][currentMode] === tier
                );

                // Ï†ÄÏû•Îêú ÏàúÏÑúÍ∞Ä ÏûàÏúºÎ©¥ Í∑∏ ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨
                if (currentTierOrders[currentMode] && currentTierOrders[currentMode][tier]) {
                    const savedOrder = currentTierOrders[currentMode][tier];
                    const orderedChars = [];
                    const unorderedChars = [];
                    
                    // Ï†ÄÏû•Îêú ÏàúÏÑúÎåÄÎ°ú Î®ºÏ†Ä Î∞∞Ïπò
                    savedOrder.forEach(charId => {
                        const char = charactersInTier.find(c => c.id === charId);
                        if (char) {
                            orderedChars.push(char);
                        }
                    });
                    
                    // Ï†ÄÏû•Îêú ÏàúÏÑúÏóê ÏóÜÎäî Ï∫êÎ¶≠ÌÑ∞Îì§ÏùÄ Îí§Ïóê Î∞∞Ïπò
                    charactersInTier.forEach(char => {
                        if (!savedOrder.includes(char.id)) {
                            unorderedChars.push(char);
                        }
                    });
                    
                    charactersInTier = [...orderedChars, ...unorderedChars];
                }

                charactersInTier.forEach(char => {
                    const card = createCharacterCard(char);
                    container.appendChild(card);
                });
            });
        }

        // Ï∫êÎ¶≠ÌÑ∞ ÌíÄ ÏóÖÎç∞Ïù¥Ìä∏
        function updateCharacterPool() {
            const pool = document.getElementById('characterPool');
            pool.innerHTML = '';

            // ÌòÑÏû¨ Ìã∞Ïñ¥Ïóê Î∞∞ÏπòÎêòÏßÄ ÏïäÏùÄ Ï∫êÎ¶≠ÌÑ∞Îì§
            const unplacedCharacters = characters.filter(char => 
                !currentTiers[char.id] || !currentTiers[char.id][currentMode]
            );

            unplacedCharacters.forEach(char => {
                const card = createCharacterCard(char);
                pool.appendChild(card);
            });
        }

        // Ï∫êÎ¶≠ÌÑ∞ Ïπ¥Îìú ÏÉùÏÑ±
        function createCharacterCard(char) {
            const card = document.createElement('div');
            card.className = 'character-card';
            card.draggable = true;
            card.dataset.characterId = char.id;
            
            // Ï∫êÎ¶≠ÌÑ∞ Ïù¥Î¶ÑÏùÑ Ï∂ïÏïΩÌïòÏó¨ ÌëúÏãú
            const getDisplayText = (name) => {
                if (name.length <= 3) return name;
                return name.substring(0, 2);
            };
            
            card.innerHTML = `
                <div class="character-image loading rarity-${char.rarity}">
                    <div class="character-initial">${getDisplayText(char.name)}</div>
                    <div class="character-rarity">${'‚òÖ'.repeat(char.rarity)}</div>
                </div>
                <div class="character-name">${char.name}</div>
            `;

            const imageElement = card.querySelector('.character-image');
            
            // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Î°úÎìú ÏãúÎèÑ
            if (char.image) {
                const img = new Image();
                img.onload = function() {
                    imageElement.style.backgroundImage = `url('${char.image}')`;
                    imageElement.classList.remove('loading');
                    // Ïù¥ÎØ∏ÏßÄ Î°úÎìú ÏÑ±Í≥µ Ïãú ÌÖçÏä§Ìä∏ Ïà®Í∏∞Í∏∞
                    const textElement = imageElement.querySelector('.character-initial');
                    if (textElement) textElement.style.display = 'none';
                };
                img.onerror = function() {
                    // Ïù¥ÎØ∏ÏßÄ Î°úÎìú Ïã§Ìå® Ïãú Ìè¥Î∞± Ïä§ÌÉÄÏùº Ï†ÅÏö©
                    imageElement.classList.remove('loading');
                    imageElement.classList.add('fallback');
                };
                img.src = char.image;
            } else {
                // Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏúºÎ©¥ Ï¶âÏãú Ìè¥Î∞± Ïä§ÌÉÄÏùº Ï†ÅÏö©
                imageElement.classList.remove('loading');
                imageElement.classList.add('fallback');
            }

            // ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏
            card.addEventListener('dragstart', function(e) {
                e.dataTransfer.setData('text/plain', char.id);
                this.classList.add('dragging');
                hideTooltip(); // ÎìúÎûòÍ∑∏ ÏãúÏûë Ïãú Ìà¥ÌåÅ Ïà®ÍπÄ
            });

            card.addEventListener('dragend', function() {
                this.classList.remove('dragging');
            });

            // Ï∫êÎ¶≠ÌÑ∞ ÌÅ¥Î¶≠ Ïãú Ìà¥ÌåÅ ÌëúÏãú
            card.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                showCharacterTooltip(char, e.pageX, e.pageY);
            });

            return card;
        }

        // Ï†ÑÏó≠ Î≥ÄÏàò
        let draggedCharacterId = null;
        let draggedElement = null;
        let currentDropTarget = null;
        let insertPosition = -1;

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ï≤òÎ¶¨
        function allowDrop(ev) {
            ev.preventDefault();
            const tierContent = ev.currentTarget;
            tierContent.classList.add('dragover');
            
            // ÎìúÎ°≠ ÏúÑÏπò Í≥ÑÏÇ∞
            updateDropIndicator(ev, tierContent);
        }

        function drop(ev) {
            ev.preventDefault();
            const tierContent = ev.currentTarget;
            tierContent.classList.remove('dragover');
            
            const characterId = ev.dataTransfer.getData('text/plain');
            const tier = tierContent.dataset.tier;
            
            // ÎìúÎ°≠ Ïù∏ÎîîÏºÄÏù¥ÌÑ∞ Ïà®Í∏∞Í∏∞
            hideDropIndicator();
            
            // Ï∫êÎ¶≠ÌÑ∞ Ìã∞Ïñ¥ ÏóÖÎç∞Ïù¥Ìä∏
            if (!currentTiers[characterId]) {
                currentTiers[characterId] = {};
            }
            currentTiers[characterId][currentMode] = tier;
            
            // Í∞ôÏùÄ Ìã∞Ïñ¥ ÎÇ¥ÏóêÏÑúÏùò ÏàúÏÑú Ï†ÄÏû•
            if (insertPosition >= 0) {
                saveTierOrder(tier, characterId, insertPosition);
            }
            
            updateDisplay();
            saveToStorage();
        }

        function updateDropIndicator(ev, tierContent) {
            const rect = tierContent.getBoundingClientRect();
            const x = ev.clientX - rect.left;
            const y = ev.clientY - rect.top;
            
            const cards = Array.from(tierContent.querySelectorAll('.character-card:not(.dragging)'));
            let insertIndex = cards.length;
            let indicatorX = rect.width - 30;
            
            for (let i = 0; i < cards.length; i++) {
                const cardRect = cards[i].getBoundingClientRect();
                const cardX = cardRect.left - rect.left;
                const cardY = cardRect.top - rect.top;
                
                // Ïπ¥ÎìúÏùò Ï§ëÏïôÏùÑ Í∏∞Ï§ÄÏúºÎ°ú ÏÇΩÏûÖ ÏúÑÏπò Í≤∞Ï†ï
                if (x < cardX + cardRect.width / 2 && 
                    y >= cardY && y <= cardY + cardRect.height) {
                    insertIndex = i;
                    indicatorX = cardX - 5;
                    break;
                }
            }
            
            insertPosition = insertIndex;
            showDropIndicator(tierContent, indicatorX);
        }

        function showDropIndicator(tierContent, x) {
            let indicator = tierContent.querySelector('.drop-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.className = 'drop-indicator';
                tierContent.appendChild(indicator);
            }
            
            indicator.style.left = x + 'px';
            indicator.style.top = '15px';
            indicator.classList.add('active');
        }

        function hideDropIndicator() {
            document.querySelectorAll('.drop-indicator').forEach(indicator => {
                indicator.classList.remove('active');
            });
        }

        // Ìã∞Ïñ¥ ÎÇ¥ Ï∫êÎ¶≠ÌÑ∞ ÏàúÏÑú Ï†ÄÏû•
        function saveTierOrder(tier, characterId, position) {
            if (!currentTierOrders) {
                currentTierOrders = {};
            }
            if (!currentTierOrders[currentMode]) {
                currentTierOrders[currentMode] = {};
            }
            if (!currentTierOrders[currentMode][tier]) {
                currentTierOrders[currentMode][tier] = [];
            }
            
            const orderArray = currentTierOrders[currentMode][tier];
            // Í∏∞Ï°¥ ÏúÑÏπòÏóêÏÑú Ï†úÍ±∞
            const existingIndex = orderArray.indexOf(characterId);
            if (existingIndex > -1) {
                orderArray.splice(existingIndex, 1);
            }
            
            // ÏÉà ÏúÑÏπòÏóê ÏÇΩÏûÖ
            orderArray.splice(position, 0, characterId);
        }

        // ÎìúÎûòÍ∑∏Ïò§Î≤Ñ Ï¢ÖÎ£å Ï≤òÎ¶¨
        document.querySelectorAll('.tier-content').forEach(content => {
            content.addEventListener('dragleave', function(e) {
                if (!this.contains(e.relatedTarget)) {
                    this.classList.remove('dragover');
                    hideDropIndicator();
                }
            });
        });

        // ÌïÑÌÑ∞ Ï†ÅÏö©
        function applyFilters() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const element = document.getElementById('elementFilter').value;
            const path = document.getElementById('pathFilter').value;

            document.querySelectorAll('.character-card').forEach(card => {
                const characterId = card.dataset.characterId;
                const char = characters.find(c => c.id === characterId);
                
                if (!char) return;

                const nameMatch = char.name.toLowerCase().includes(search) || 
                                char.enName.toLowerCase().includes(search);
                const elementMatch = !element || char.element === element;
                const pathMatch = !path || char.path === path;
                
                if (nameMatch && elementMatch && pathMatch) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }

        // Ï†ÄÏû•/Î∂àÎü¨Ïò§Í∏∞ Í∏∞Îä•
        function saveTierList() {
            const data = {
                currentTiers: currentTiers,
                currentTierOrders: currentTierOrders,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `hsr_tierlist_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadTierList() {
            document.getElementById('fileInput').click();
        }

        function importTierList(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.currentTiers) {
                        currentTiers = data.currentTiers;
                        // ÏàúÏÑú Ï†ïÎ≥¥Í∞Ä ÏûàÏúºÎ©¥ Î∂àÎü¨Ïò§Í∏∞
                        if (data.currentTierOrders) {
                            currentTierOrders = data.currentTierOrders;
                        }
                        updateDisplay();
                        saveToStorage();
                        alert('Ìã∞Ïñ¥ÌëúÎ•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§!');
                    } else {
                        throw new Error('Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏùÄ ÌååÏùº ÌòïÏãùÏûÖÎãàÎã§.');
                    }
                } catch (err) {
                    alert('ÌååÏùºÏùÑ Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§: ' + err.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function resetTierList() {
            if (confirm('Ìã∞Ïñ¥ÌëúÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå? ÌòÑÏû¨ ÏÑ§Ï†ïÏù¥ Î™®Îëê ÏÇ¨ÎùºÏßëÎãàÎã§.')) {
                currentTierOrders = {};
                initializeTierList();
                saveToStorage();
            }
        }

        async function exportImage(buttonElement) {
            let originalText = '';
            try {
                // Î°úÎî© Î©îÏãúÏßÄ ÌëúÏãú
                if (buttonElement) {
                    originalText = buttonElement.textContent;
                    buttonElement.textContent = 'üì∏ Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë...';
                    buttonElement.disabled = true;
                }

                // Ìã∞Ïñ¥ Î≥¥Îìú ÏòÅÏó≠Îßå Ï∫°Ï≤ò
                const tierBoard = document.querySelector('.tier-board');
                if (!tierBoard) {
                    throw new Error('Ìã∞Ïñ¥ Î≥¥ÎìúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
                }
                
                // Ïû†Ïãú ÎåÄÍ∏∞ÌïòÏó¨ Î™®Îì† Ïù¥ÎØ∏ÏßÄÍ∞Ä Î°úÎìúÎêòÎèÑÎ°ù Ìï®
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Îã®ÏàúÌïú ÏòµÏÖòÏúºÎ°ú ÏÑ§Ï†ï
                const options = {
                    backgroundColor: '#1a237e',
                    scale: 1,
                    useCORS: false,
                    allowTaint: true,
                    logging: false,
                    width: tierBoard.offsetWidth,
                    height: tierBoard.offsetHeight,
                    onclone: function(clonedDoc) {
                        try {
                            // Î≥µÏ†úÎêú Î¨∏ÏÑúÏóêÏÑú Ïä§ÌÉÄÏùº Í∞ÑÏÜåÌôî
                            const clonedTierBoard = clonedDoc.querySelector('.tier-board');
                            if (clonedTierBoard) {
                                clonedTierBoard.style.background = '#1a237e';
                            }
                            
                            // Ìà¥ÌåÅ Ï†úÍ±∞
                            const tooltips = clonedDoc.querySelectorAll('.character-tooltip');
                            tooltips.forEach(tooltip => tooltip.remove());
                            
                        } catch (cloneError) {
                            console.warn('Clone Ï≤òÎ¶¨ Ï§ë Ïò§Î•ò:', cloneError);
                        }
                    }
                };

                console.log('Ï∫°Ï≤ò ÏãúÏûë...');
                
                // html2canvasÎ°ú Ï∫°Ï≤ò
                const canvas = await html2canvas(tierBoard, options);
                
                if (!canvas) {
                    throw new Error('Ï∫îÎ≤ÑÏä§ ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.');
                }
                
                console.log('Ï∫°Ï≤ò ÏôÑÎ£å, Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ï§ë...');
                
                // Ï∫îÎ≤ÑÏä§Î•º Ïù¥ÎØ∏ÏßÄÎ°ú Î≥ÄÌôò
                const dataURL = canvas.toDataURL('image/png', 0.9);
                
                // Îã§Ïö¥Î°úÎìú ÎßÅÌÅ¨ ÏÉùÏÑ±
                const link = document.createElement('a');
                link.download = `hsr_tierlist_${new Date().toISOString().split('T')[0]}.png`;
                link.href = dataURL;
                
                // ÏûêÎèô Îã§Ïö¥Î°úÎìú Ïã§Ìñâ
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                alert('Ìã∞Ïñ¥Ìëú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!');
                
            } catch (error) {
                console.error('Ïù¥ÎØ∏ÏßÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞ Ïã§Ìå®:', error);
                alert(`Ïù¥ÎØ∏ÏßÄ ÎÇ¥Î≥¥ÎÇ¥Í∏∞Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§: ${error.message}`);
            } finally {
                // Î≤ÑÌäº ÌÖçÏä§Ìä∏ Î≥µÏõê
                if (buttonElement) {
                    buttonElement.textContent = originalText;
                    buttonElement.disabled = false;
                }
            }
        }

        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Í¥ÄÎ¶¨
        function saveToStorage() {
            localStorage.setItem('hsr_tierlist', JSON.stringify({
                currentTiers: currentTiers,
                currentTierOrders: currentTierOrders,
                currentMode: currentMode
            }));
        }

        function loadFromStorage() {
            const saved = localStorage.getItem('hsr_tierlist');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.currentTiers) {
                        currentTiers = data.currentTiers;
                    }
                    if (data.currentTierOrders) {
                        currentTierOrders = data.currentTierOrders;
                    }
                    if (data.currentMode) {
                        setMode(data.currentMode);
                    }
                    updateDisplay();
                } catch (e) {
                    console.error('Ï†ÄÏû•Îêú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§:', e);
                }
            }
        }

        // ÏÉà Ï∫êÎ¶≠ÌÑ∞ Ï∂îÍ∞Ä Î™®Îã¨ Í¥ÄÎ¶¨
        function openAddCharacterModal() {
            document.getElementById('addCharacterModal').style.display = 'block';
            document.body.style.overflow = 'hidden';
        }

        function closeAddCharacterModal() {
            document.getElementById('addCharacterModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            // Ìèº Î¶¨ÏÖã
            document.getElementById('addCharacterForm').reset();
        }

        // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
        window.onclick = function(event) {
            const modal = document.getElementById('addCharacterModal');
            if (event.target === modal) {
                closeAddCharacterModal();
            }
        }

        // ÏÉà Ï∫êÎ¶≠ÌÑ∞ Ï∂îÍ∞Ä Ìèº Ï≤òÎ¶¨
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('addCharacterForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addNewCharacter();
            });
        });

        function addNewCharacter() {
            // Ìèº Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
            const formData = {
                id: document.getElementById('charId').value.trim(),
                name: document.getElementById('charName').value.trim(),
                enName: document.getElementById('charEnName').value.trim(),
                rarity: parseInt(document.getElementById('charRarity').value),
                element: document.getElementById('charElement').value,
                path: document.getElementById('charPath').value,
                image: document.getElementById('charImage').value.trim(),
                defaultTiers: {
                    general: document.getElementById('tierGeneral').value,
                    chaos: document.getElementById('tierChaos').value,
                    pure: document.getElementById('tierPure').value,
                    apocalyptic: document.getElementById('tierApocalyptic').value
                }
            };

            // Ïú†Ìö®ÏÑ± Í≤ÄÏÇ¨
            if (!formData.id || !formData.name || !formData.enName || !formData.rarity || 
                !formData.element || !formData.path) {
                alert('ÌïÑÏàò Ìï≠Î™©ÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            // ID Ï§ëÎ≥µ Í≤ÄÏÇ¨
            if (characters.find(char => char.id === formData.id)) {
                alert('Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÎäî Ï∫êÎ¶≠ÌÑ∞ IDÏûÖÎãàÎã§.');
                return;
            }

            // Ï∫êÎ¶≠ÌÑ∞ Ï∂îÍ∞Ä
            characters.push(formData);
            
            // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
            updateDisplay();
            
            // Î™®Îã¨ Îã´Í∏∞
            closeAddCharacterModal();
            
            alert(`${formData.name} Ï∫êÎ¶≠ÌÑ∞Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÍ∞ÄÎêòÏóàÏäµÎãàÎã§!`);
        }

        // Ï∫êÎ¶≠ÌÑ∞ Ìà¥ÌåÅ Í¥ÄÎ†® Ìï®ÏàòÎì§
        let currentTooltip = null;

        function showCharacterTooltip(character, x, y) {
            hideTooltip(); // Í∏∞Ï°¥ Ìà¥ÌåÅ Ïà®ÍπÄ
            
            // ÌïúÍµ≠Ïñ¥Î°ú ÏÜçÏÑ±Í≥º Ïö¥Î™ÖÏùò Í∏∏ Î≥ÄÌôò
            const elementKR = {
                'Physical': 'Î¨ºÎ¶¨',
                'Fire': 'Î∂à',
                'Ice': 'ÏñºÏùå',
                'Lightning': 'Î≤àÍ∞ú',
                'Wind': 'Î∞îÎûå',
                'Quantum': 'ÏñëÏûê',
                'Imaginary': 'ÌóàÏàò'
            };
            
            const pathKR = {
                'Destruction': 'Î©∏Îßù',
                'Hunt': 'ÏàòÎ†µ',
                'Erudition': 'ÏßÄÏãù',
                'Harmony': 'Ï°∞Ìôî',
                'Nihility': 'ÌóàÎ¨¥',
                'Preservation': 'Ï°¥Ìò∏',
                'Abundance': 'ÌíçÏöî',
                'Memories': 'Í∏∞Ïñµ'
            };

            // Ìà¥ÌåÅ ÏÉùÏÑ±
            const tooltip = document.createElement('div');
            tooltip.className = 'character-tooltip';
            tooltip.innerHTML = `
                <div><strong>${character.name}</strong> (${character.enName})</div>
                <div>ÏÜçÏÑ±: <span class="tooltip-element">${elementKR[character.element] || character.element}</span></div>
                <div>Ïö¥Î™Ö: <span class="tooltip-path">${pathKR[character.path] || character.path}</span></div>
                <div>${'‚òÖ'.repeat(character.rarity)}ÏÑ±</div>
            `;

            // bodyÏóê Ï∂îÍ∞Ä
            document.body.appendChild(tooltip);
            currentTooltip = tooltip;

            // ÏúÑÏπò Í≥ÑÏÇ∞ Î∞è ÏÑ§Ï†ï
            const rect = tooltip.getBoundingClientRect();
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;

            let left = x - rect.width / 2;
            let top = y - rect.height - 15;

            // ÌôîÎ©¥ Í≤ΩÍ≥Ñ Ï≤¥ÌÅ¨
            if (left < 10) left = 10;
            if (left + rect.width > viewportWidth - 10) left = viewportWidth - rect.width - 10;
            if (top < 10) top = y + 15;

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';

            // Ïï†ÎãàÎ©îÏù¥ÏÖòÏúºÎ°ú ÌëúÏãú
            setTimeout(() => {
                tooltip.classList.add('show');
            }, 10);

            // 3Ï¥à ÌõÑ ÏûêÎèô Ïà®ÍπÄ
            setTimeout(() => {
                hideTooltip();
            }, 3000);
        }

        function hideTooltip() {
            if (currentTooltip) {
                currentTooltip.classList.remove('show');
                setTimeout(() => {
                    if (currentTooltip && currentTooltip.parentNode) {
                        currentTooltip.parentNode.removeChild(currentTooltip);
                    }
                    currentTooltip = null;
                }, 200);
            }
        }

        // Î¨∏ÏÑú ÌÅ¥Î¶≠ Ïãú Ìà¥ÌåÅ Ïà®ÍπÄ
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.character-card')) {
                hideTooltip();
            }
        });

        // Ïä§ÌÅ¨Î°§ Ïãú Ìà¥ÌåÅ Ïà®ÍπÄ
        window.addEventListener('scroll', hideTooltip);
    </script>
</body>
</html>
